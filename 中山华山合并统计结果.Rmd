ï»?---
title: "0426hospital combine"
author: "xvyingrui"
date: "2018å¹?4æœ?26?"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r  message=FALSE,warning=FALSE,error=FALSE}
library(readr)
library(tidyverse)
library(knitr)
library(broom)
library(foreign)
```


```{r  message=FALSE,warning=FALSE,error=FALSE}

zs.dz=read.csv('h:/data/gaoyue1221åˆå¹¶/0417å¢åŠ /ä¸­å±±å¯¹ç…§ç»?0419éšè®¿2å¹´ç»“æ?.csv')
zs.sy=read.csv('h:/data/gaoyue1221åˆå¹¶/0417å¢åŠ /ä¸­å±±å®éªŒç»?0419éšè®¿2å¹´ç»“æ?.csv')

hs.dz=read.csv('h:/data/gaoyue1221åˆå¹¶/0417å¢åŠ /åå±±å¯¹ç…§ç»?0423éšè®¿2å¹?.csv')
hs.sy=read.csv('h:/data/gaoyue1221åˆå¹¶/0417å¢åŠ /åå±±å®éªŒç»?0423éšè®¿2å¹´ç»“æ?.csv')

```


```{r}
mystats<-function(x,na.omit=FALSE){
  y=sum(is.na(x))
  if(na.omit)
    x<-x[!is.na(x)]
  l=length(x)
  m<-round(mean(x),4)
  n<-round(sd(x),4)
  o<-round(median(x),4)
  p<-round(quantile(x,0.25),4)
  q<-round(quantile(x,0.75),4)
  r<-round(min(x),4)
  s<-round(max(x),4)
  t<-round(length(which(x==0)),4)
  u<-round(length(which(x>0)),4)
  return(c(n=l,ç¼ºå¤±å€?=y,mean=m,sd=n,median=o,median1=p,
           median3=q,min=r,max=s,ç­‰äº0çš„ä¸ªæ•?=t,å¤§äº0çš„ä¸ªæ•?=u))
}

```


#####æŸ¥çœ‹å®éªŒç»„æ•°æ®çš„åå­—

```{r  message=FALSE,warning=FALSE,error=FALSE}
cbind(kable(names(hs.sy)),kable(names(zs.sy)))

```

```{r}
#æ•´ç†å®éªŒç»„çš„åç§°

zs.sy$end_start1=ifelse(zs.sy$end_start1<1,1,zs.sy$end_start1)
zs.sy1=zs.sy%>%
  rename(ID=é—¨è¯Šå?)%>%
  mutate(ä¸€å¹´å¿ƒè¡€ç®¡æ¬¡æ•?=é—¨è¯Šå¿ƒè¡€ç®¡æ¬¡æ•?+ä½é™¢å¿ƒè¡€ç®¡æ¬¡æ•?,
                é—¨è¯ŠåŠ ä½é™¢æ‰€æœ‰å¿ƒè¡€ç®¡æ¬¡æ•?=é—¨è¯Šæ‰€æœ‰æ—¶é—´å¿ƒè¡€ç®¡æ¬¡æ•?+ä½é™¢æ‰€æœ‰æ—¶é—´å¿ƒè¡€ç®¡æ¬¡æ•?,
                é—¨è¯Šå‘ç”Ÿé¢‘ç‡=é—¨è¯Šæ‰€æœ‰æ—¶é—´å¿ƒè¡€ç®¡æ¬¡æ•?/end_start1,
                æ€»å‘ç”Ÿé¢‘ç?=(é—¨è¯Šæ‰€æœ‰æ—¶é—´å¿ƒè¡€ç®¡æ¬¡æ•?+ä½é™¢æ‰€æœ‰æ—¶é—´å¿ƒè¡€ç®¡æ¬¡æ•?)/end_start1,
                é—¨è¯ŠåŠ ä½é™¢è´¹ç”?=é—¨è¯Šè´¹ç”¨+ä½é™¢è´¹ç”¨,
                å¿ƒè¡€ç®¡èµ„æºé—¨è¯ŠåŠ ä½é™¢è´¹ç”¨=å¿ƒè¡€ç®¡èµ„æºé—¨è¯Šè´¹ç”?+å¿ƒè¡€ç®¡èµ„æºä½é™¢è´¹ç”?)%>%
  select(-c(ä½é™¢è¯å“è´¹ç”¨,ä½é™¢éè¯å“è´¹ç”?,å¿ƒè¡€ç®¡èµ„æºä½é™¢è¯å“è´¹ç”?,å¿ƒè¡€ç®¡èµ„æºéè¯å“è´¹ç”¨))
str(zs.sy1)


```

```{r}
  hs.sy1=hs.sy%>%
    rename(é—¨è¯Šæ‰€æœ‰æ—¶é—´å¿ƒè¡€ç®¡æ¬¡æ•?=é—¨è¯Šæ‰€æœ‰å¿ƒè¡€ç®¡æ¬¡æ•?,
                      ä½é™¢æ‰€æœ‰æ—¶é—´å¿ƒè¡€ç®¡æ¬¡æ•?=ä½é™¢æ‰€æœ‰å¿ƒè¡€ç®¡æ¬¡æ•?,
                      å‡ºç”Ÿæ—¥æœŸ=MAX.SENGR.,ä¿é™©ç±»åˆ«=MAX.DECODE.E.JZFSM..1...è‡ªè´¹..,
                      ç§‘å®¤åç§°=MAX.DEPTNAME.,
                      å¿ƒè¡€ç®¡èµ„æºé—¨è¯Šè´¹ç”?=é—¨è¯Šå¿ƒè¡€ç®¡èµ„æºè´¹ç”?)
  
  
  hs.sy1$ä¸€å¹´å¿ƒè¡€ç®¡æ¬¡æ•?=hs.sy1$é—¨è¯Šå¿ƒè¡€ç®¡æ¬¡æ•?+hs.sy1$ä½é™¢å¿ƒè¡€ç®¡æ¬¡æ•?
  hs.sy1$é—¨è¯ŠåŠ ä½é™¢è´¹ç”?=hs.sy1$é—¨è¯Šè´¹ç”¨+hs.sy1$ä½é™¢è´¹ç”¨
  hs.sy1$å¿ƒè¡€ç®¡èµ„æºé—¨è¯ŠåŠ ä½é™¢è´¹ç”¨=hs.sy1$å¿ƒè¡€ç®¡èµ„æºé—¨è¯Šè´¹ç”?+hs.sy1$å¿ƒè¡€ç®¡èµ„æºä½é™¢è´¹ç”?
  str(hs.sy1)

zs.hs.sy=rbind(zs.sy1,hs.sy1)

zs.hs.sy$age=2017-as.numeric(substr(zs.hs.sy$å‡ºç”Ÿæ—¥æœŸ,1,4))
zs.hs.sy=zs.hs.sy[!duplicated(zs.hs.sy$ID),]

```



#####æŸ¥çœ‹æ˜¯å¦æœ‰ç¼ºå¤±å€?
```{r}
kable(sapply(zs.hs.sy,function(x){sum(is.na(x))}))
```

```{r}
str(zs.hs.sy)

```

#####è¿ç»­å˜é‡çš„ç»Ÿè®?
```{r}
lapply(zs.hs.sy[,c(6:16,21:27)],function(x){mystats(x)})%>%as.data.frame.list()%>%t()%>%kable()

```


######.............................................................

####å¯¹ç…§ç»„åˆå¹?
```{r  message=FALSE,warning=FALSE,error=FALSE}
cbind(kable(names(hs.dz)),kable(names(zs.dz)))
```


####æ•´ç†åå±±åŒ»é™¢å¯¹ç…§ç»?
```{r}
hs.dz1=hs.dz%>%
  rename(é—¨è¯Šæ‰€æœ‰æ—¶é—´å¿ƒè¡€ç®¡æ¬¡æ•?=é—¨è¯Šæ‰€æœ‰å¿ƒè¡€ç®¡æ¬¡æ•?,ä½é™¢æ‰€æœ‰æ—¶é—´å¿ƒè¡€ç®¡æ¬¡æ•?=ä½é™¢æ‰€æœ‰å¿ƒè¡€ç®¡æ¬¡æ•?,é—¨è¯Šè´¹ç”¨=é—¨è¯Šæ€»è´¹ç”?,ID=é—¨è¯Šå?,ç§‘å®¤åç§°=ç§‘å®¤,ä½é™¢å¤©æ•°=ä½é™¢å¤©æ•°.x)%>%
  select(-MEDCARD,-é—¨è¯Šè´¹ç”¨1,-é—¨è¯Šè´¹ç”¨2)%>%
  mutate(ä¸€å¹´å¿ƒè¡€ç®¡æ¬¡æ•?=é—¨è¯Šå¿ƒè¡€ç®¡æ¬¡æ•?+ä½é™¢å¿ƒè¡€ç®¡æ¬¡æ•?,
                é—¨è¯ŠåŠ ä½é™¢æ‰€æœ‰å¿ƒè¡€ç®¡æ¬¡æ•?=é—¨è¯Šæ‰€æœ‰æ—¶é—´å¿ƒè¡€ç®¡æ¬¡æ•?+ä½é™¢æ‰€æœ‰æ—¶é—´å¿ƒè¡€ç®¡æ¬¡æ•?)

```


####æ•´ç†ä¸­å±±åŒ»é™¢å¯¹ç…§ç»?
```{r  message=FALSE,warning=FALSE,error=FALSE}

zs.dz$end_start1=ifelse(zs.dz$end_start1<1,1,zs.dz$end_start1)
zs.dz1=zs.dz%>%
  rename(ID=é—¨è¯Šå?)%>%
  mutate(é—¨è¯ŠåŠ ä½é™¢æ€»è´¹ç”?=é—¨è¯Šè´¹ç”¨+ä½é™¢è´¹ç”¨,å¿ƒè¡€ç®¡èµ„æºé—¨è¯ŠåŠ ä½é™¢æ€»è´¹ç”?=å¿ƒè¡€ç®¡èµ„æºé—¨è¯Šè´¹ç”?+å¿ƒè¡€ç®¡èµ„æºä½é™¢è´¹ç”?,
                 é—¨è¯Šå‘ç”Ÿé¢‘ç‡=é—¨è¯Šæ‰€æœ‰æ—¶é—´å¿ƒè¡€ç®¡æ¬¡æ•?/end_start1,
                 æ€»å‘ç”Ÿé¢‘ç?=(é—¨è¯Šæ‰€æœ‰æ—¶é—´å¿ƒè¡€ç®¡æ¬¡æ•?+ä½é™¢æ‰€æœ‰æ—¶é—´å¿ƒè¡€ç®¡æ¬¡æ•?)/end_start1,
                 ä¸€å¹´å¿ƒè¡€ç®¡æ¬¡æ•?=é—¨è¯Šå¿ƒè¡€ç®¡æ¬¡æ•?+ä½é™¢å¿ƒè¡€ç®¡æ¬¡æ•?,
                 é—¨è¯ŠåŠ ä½é™¢æ‰€æœ‰å¿ƒè¡€ç®¡æ¬¡æ•?=é—¨è¯Šæ‰€æœ‰æ—¶é—´å¿ƒè¡€ç®¡æ¬¡æ•?+ä½é™¢æ‰€æœ‰æ—¶é—´å¿ƒè¡€ç®¡æ¬¡æ•?)%>%
  select(-c(ä½é™¢è¯å“è´¹ç”¨,ä½é™¢éè¯å“è´¹ç”?,å¿ƒè¡€ç®¡èµ„æºä½é™¢è¯å“è´¹ç”?,å¿ƒè¡€ç®¡èµ„æºéè¯å“è´¹ç”¨))

cbind(kable(names(hs.dz1)),kable(names(zs.dz1)))

zs.hs.dz=rbind(hs.dz1,zs.dz1)

zs.hs.dz$age=2017-as.numeric(substr(zs.hs.dz$å‡ºç”Ÿæ—¥æœŸ,1,4))


```



#####æŸ¥çœ‹æ˜¯å¦æœ‰ç¼ºå¤±å€?
```{r}
kable(sapply(zs.hs.dz,function(x){sum(is.na(x))}))
```

```{r}
str(zs.hs.dz)

```

#####è¿ç»­å˜é‡çš„ç»Ÿè®?
```{r}
lapply(zs.hs.dz[,c(5:11,13:20,25:26)],function(x){mystats(x)})%>%as.data.frame.list()%>%t()%>%as.data.frame()

```



###äºŒã€å•å› ç´ åˆ†æ

```{r}
#zs.hs.dz
#zs.hs.sy
kable(data.frame(colnames(zs.hs.sy),colnames(zs.hs.dz)))

t.test(zs.hs.sy$é—¨è¯Šæ¬¡æ•°,zs.hs.dz$é—¨è¯Šæ¬¡æ•°)%>%tidy()%>%t()%>%kable(col.names ="é—¨è¯Šæ¬¡æ•°")
t.test(zs.hs.sy$é—¨è¯Šå¿ƒè¡€ç®¡æ¬¡æ•?,zs.hs.dz$é—¨è¯Šå¿ƒè¡€ç®¡æ¬¡æ•?)%>%tidy()%>%t()%>%kable(col.names ="é—¨è¯Šå¿ƒè¡€ç®¡æ¬¡æ•?")
t.test(zs.hs.sy$é—¨è¯Šæ‰€æœ‰æ—¶é—´å¿ƒè¡€ç®¡æ¬¡æ•?,zs.hs.dz$é—¨è¯Šæ‰€æœ‰æ—¶é—´å¿ƒè¡€ç®¡æ¬¡æ•?)%>%tidy()%>%t()%>%kable(col.names ="é—¨è¯Šæ‰€æœ‰æ—¶é—´å¿ƒè¡€ç®¡æ¬¡æ•?")
t.test(zs.hs.sy$ä½é™¢æ¬¡æ•°,zs.hs.dz$ä½é™¢æ¬¡æ•°)%>%tidy()%>%t()%>%kable(col.names ="ä½é™¢æ¬¡æ•°")
t.test(zs.hs.sy$ä½é™¢å¿ƒè¡€ç®¡æ¬¡æ•?,zs.hs.dz$ä½é™¢å¿ƒè¡€ç®¡æ¬¡æ•?)%>%tidy()%>%t()%>%kable(col.names ="ä½é™¢å¿ƒè¡€ç®¡æ¬¡æ•?")
t.test(zs.hs.sy$ä½é™¢å¤©æ•°,zs.hs.dz$ä½é™¢å¤©æ•°)%>%tidy()%>%t()%>%kable(col.names ="ä½é™¢å¤©æ•°")
t.test(zs.hs.sy$ä½é™¢æ‰€æœ‰æ—¶é—´å¿ƒè¡€ç®¡æ¬¡æ•?,zs.hs.dz$ä½é™¢æ‰€æœ‰æ—¶é—´å¿ƒè¡€ç®¡æ¬¡æ•?)%>%tidy()%>%t()%>%kable(col.names ="ä½é™¢æ‰€æœ‰æ—¶é—´å¿ƒè¡€ç®¡æ¬¡æ•?")
t.test(zs.hs.sy$é—¨è¯Šè´¹ç”¨,zs.hs.dz$é—¨è¯Šè´¹ç”¨)%>%tidy()%>%t()%>%kable(col.names ="é—¨è¯Šè´¹ç”¨")
t.test(zs.hs.sy$ä½é™¢è´¹ç”¨,zs.hs.dz$ä½é™¢è´¹ç”¨)%>%tidy()%>%t()%>%kable(col.names ="ä½é™¢è´¹ç”¨")
t.test(zs.hs.sy$å¿ƒè¡€ç®¡èµ„æºé—¨è¯Šè´¹ç”?,zs.hs.dz$å¿ƒè¡€ç®¡èµ„æºé—¨è¯Šè´¹ç”?)%>%tidy()%>%t()%>%kable(col.names = "å¿ƒè¡€ç®¡èµ„æºé—¨è¯Šè´¹ç”?")
t.test(zs.hs.sy$å¿ƒè¡€ç®¡èµ„æºä½é™¢è´¹ç”?,zs.hs.dz$å¿ƒè¡€ç®¡èµ„æºä½é™¢è´¹ç”?)%>%tidy()%>%t()%>%kable(col.names ="å¿ƒè¡€ç®¡èµ„æºä½é™¢è´¹ç”?")
t.test(zs.hs.sy$ä¸€å¹´å¿ƒè¡€ç®¡æ¬¡æ•?,zs.hs.dz$ä¸€å¹´å¿ƒè¡€ç®¡æ¬¡æ•?)%>%tidy()%>%t()%>%kable(col.names ="ä¸€å¹´å¿ƒè¡€ç®¡æ¬¡æ•?")
t.test(zs.hs.sy$é—¨è¯ŠåŠ ä½é™¢æ‰€æœ‰å¿ƒè¡€ç®¡æ¬¡æ•?,zs.hs.dz$é—¨è¯ŠåŠ ä½é™¢æ‰€æœ‰å¿ƒè¡€ç®¡æ¬¡æ•?)%>%tidy()%>%t()%>%kable(col.names ="é—¨è¯ŠåŠ ä½é™¢æ‰€æœ‰å¿ƒè¡€ç®¡æ¬¡æ•?")
t.test(zs.hs.sy$é—¨è¯ŠåŠ ä½é™¢è´¹ç”?,zs.hs.dz$é—¨è¯ŠåŠ ä½é™¢è´¹ç”?)%>%tidy()%>%t()%>%kable(col.names ="é—¨è¯ŠåŠ ä½é™¢è´¹ç”?")
t.test(zs.hs.sy$å¿ƒè¡€ç®¡èµ„æºé—¨è¯ŠåŠ ä½é™¢è´¹ç”¨,zs.hs.dz$å¿ƒè¡€ç®¡èµ„æºé—¨è¯ŠåŠ ä½é™¢è´¹ç”¨)%>%tidy()%>%t()%>%kable(col.names ='å¿ƒè¡€ç®¡èµ„æºé—¨è¯ŠåŠ ä½é™¢è´¹ç”¨')

t.test(zs.hs.sy$é—¨è¯Šå‘ç”Ÿé¢‘ç‡,zs.hs.dz$é—¨è¯Šå‘ç”Ÿé¢‘ç‡)%>%tidy()%>%t()%>%kable(col.names ="é—¨è¯Šå‘ç”Ÿé¢‘ç‡")
t.test(zs.hs.sy$æ€»å‘ç”Ÿé¢‘ç?,zs.hs.dz$æ€»å‘ç”Ÿé¢‘ç?)%>%tidy()%>%t()%>%kable(col.names ='æ€»å‘ç”Ÿé¢‘ç?')



```


###å›å½’æ¨¡å‹æ‹Ÿåˆ
### æ•°æ®é¢„å¤„ç?
#### åˆ†ææ•°æ®åº“ä¸º
#### 1ã€zs.hs.sy
#### 2ã€zs.hs.dz





```{r}
zs.hs.dz=rbind(hs.dz1,zs.dz1)
zs.hs.dz$age=2017-as.numeric(substr(zs.hs.dz$å‡ºç”Ÿæ—¥æœŸ,1,4))
zs.hs.sy=rbind(zs.sy1,hs.sy1)
zs.hs.sy$age=2017-as.numeric(substr(zs.hs.sy$å‡ºç”Ÿæ—¥æœŸ,1,4))
zs.hs.sy=zs.hs.sy[!duplicated(zs.hs.sy$ID),]




zs.hs.sy$æ˜¯å¦ä½¿ç”¨ä¸¹å‚=rep(1,nrow(zs.hs.sy))
zs.hs.dz$æ˜¯å¦ä½¿ç”¨ä¸¹å‚=rep(0,nrow(zs.hs.dz))
zs.hs.dz=zs.hs.dz%>%
  rename(å¿ƒè¡€ç®¡èµ„æºé—¨è¯ŠåŠ ä½é™¢è´¹ç”¨=å¿ƒè¡€ç®¡èµ„æºé—¨è¯ŠåŠ ä½é™¢æ€»è´¹ç”?,é—¨è¯ŠåŠ ä½é™¢è´¹ç”?=é—¨è¯ŠåŠ ä½é™¢æ€»è´¹ç”?)
zs.hs.hz=rbind(zs.hs.sy,zs.hs.dz)
zs.hs.hz$æ˜¯å¦ä½¿ç”¨ä¸¹å‚=as.factor(zs.hs.hz$æ˜¯å¦ä½¿ç”¨ä¸¹å‚)
(str(zs.hs.hz))

bianliang=zs.hs.hz[,c("é—¨è¯Šè´¹ç”¨","ä½é™¢è´¹ç”¨","é—¨è¯ŠåŠ ä½é™¢è´¹ç”?","æ˜¯å¦ä½¿ç”¨ä¸¹å‚","age","æ€§åˆ«","ä¿é™©ç±»åˆ«")]
```


##ä¸‰ã€å¯¹ä»¥ä¸‹ç»ˆç‚¹äº‹ä»¶æ‹Ÿåˆè´ŸäºŒé¡¹å›å½’æ¨¡å?

####1ã€æ€»å¿ƒè¡€ç®¡äº‹ä»¶çš„å‘ç”Ÿæ¬¡æ•°
####2ã€æ€»å¿ƒè¡€ç®¡äº‹ä»¶ç›¸å…³ä½é™¢å¤©æ•?
####3ã€æ€»å¿ƒè¡€ç®¡äº‹ä»¶é—¨è¯Šæ¬¡æ•?
####4ã€æ€»å¿ƒè¡€ç®¡äº‹ä»¶ä½é™¢æ¬¡æ•?


###1ã€æ€»å¿ƒè¡€ç®¡äº‹ä»¶çš„å‘ç”Ÿæ¬¡æ•°
```{r}
#1ã€æ€»å¿ƒè¡€ç®¡äº‹ä»¶å‘ç”Ÿæ¬¡æ•?
zs.hs.hz1=zs.hs.hz[,c("ä¸€å¹´å¿ƒè¡€ç®¡æ¬¡æ•?","æ€§åˆ«","ä¿é™©ç±»åˆ«","age","æ˜¯å¦ä½¿ç”¨ä¸¹å‚")]

#åŸºæœ¬æƒ…å†µæè¿°
ggplot(zs.hs.hz1, aes(ä¸€å¹´å¿ƒè¡€ç®¡æ¬¡æ•?, fill = æ˜¯å¦ä½¿ç”¨ä¸¹å‚)) + geom_histogram(binwidth = 1) + facet_grid(æ˜¯å¦ä½¿ç”¨ä¸¹å‚ ~ 
    ., margins = TRUE, scales = "free")

#è®¡ç®—å¹³å‡å€¼å’Œæ ‡å‡†å·?
with(zs.hs.hz1, tapply(ä¸€å¹´å¿ƒè¡€ç®¡æ¬¡æ•?, æ˜¯å¦ä½¿ç”¨ä¸¹å‚, function(x) {
    sprintf("M (SD) = %1.2f (%1.2f)", mean(x), sd(x))
}))

#æ‹Ÿåˆè´ŸäºŒé¡¹å›å½?
summary(m1 <- MASS::glm.nb(ä¸€å¹´å¿ƒè¡€ç®¡æ¬¡æ•? ~., data = zs.hs.hz1))



zs.hs.hz1$predicty=fitted(m1)

 with(zs.hs.hz1,tapply(predicty, æ˜¯å¦ä½¿ç”¨ä¸¹å‚, function(x) {
    sprintf("M (SE) = %1.2f (%1.2f)", mean(x), sd(x)/sqrt(length(x)))
}))

```

```{r}
#æ¨¡å‹æ£€éª?
m2 <- update(m1, . ~ . - æ˜¯å¦ä½¿ç”¨ä¸¹å‚)
anova(m1, m2)%>%kable()

```

###2ã€æ€»å¿ƒè¡€ç®¡äº‹ä»¶ç›¸å…³ä½é™¢å¤©æ•?


```{r}
#2ã€æ€»å¿ƒè¡€ç®¡äº‹ä»¶ç›¸å…³ä½é™¢å¤©æ•?
zs.hs.hz1=zs.hs.hz[,c("ä½é™¢å¤©æ•°","æ€§åˆ«","ä¿é™©ç±»åˆ«","age","æ˜¯å¦ä½¿ç”¨ä¸¹å‚")]

#åŸºæœ¬æƒ…å†µæè¿°
ggplot(zs.hs.hz1, aes(ä½é™¢å¤©æ•°, fill = æ˜¯å¦ä½¿ç”¨ä¸¹å‚)) + geom_histogram(binwidth = 1) + facet_grid(æ˜¯å¦ä½¿ç”¨ä¸¹å‚ ~ 
    ., margins = TRUE, scales = "free")

with(zs.hs.hz1, tapply(ä½é™¢å¤©æ•°, æ˜¯å¦ä½¿ç”¨ä¸¹å‚, function(x) {
    sprintf("M (SD) = %1.2f (%1.2f)", mean(x), sd(x))
}))

#æ‹Ÿåˆè´ŸäºŒé¡¹å›å½?
summary(m1 <- lm(ä½é™¢å¤©æ•° ~., data = zs.hs.hz1))


zs.hs.hz1$predicty=fitted(m1)

with(zs.hs.hz1, tapply(predicty, æ˜¯å¦ä½¿ç”¨ä¸¹å‚, function(x) {
    sprintf("M (SE) = %1.2f (%1.2f)", mean(x), sd(x)/sqrt(length(x)))
}))

```

```{r}
m2 <- update(m1, . ~ . - æ˜¯å¦ä½¿ç”¨ä¸¹å‚)
anova(m1, m2)%>%kable()

```

###3ã€æ€»å¿ƒè¡€ç®¡äº‹ä»¶ç›¸å…³é—¨è¯Šæ¬¡æ•?

```{r}
#3ã€æ€»å¿ƒè¡€ç®¡äº‹ä»¶ç›¸å…³é—¨è¯Šæ¬¡æ•?
zs.hs.hz1=zs.hs.hz[,c("é—¨è¯Šå¿ƒè¡€ç®¡æ¬¡æ•?","æ€§åˆ«","ä¿é™©ç±»åˆ«","age","æ˜¯å¦ä½¿ç”¨ä¸¹å‚")]

#åŸºæœ¬æƒ…å†µæè¿°
ggplot(zs.hs.hz1, aes(é—¨è¯Šå¿ƒè¡€ç®¡æ¬¡æ•?, fill = æ˜¯å¦ä½¿ç”¨ä¸¹å‚)) + geom_histogram(binwidth = 1) + facet_grid(æ˜¯å¦ä½¿ç”¨ä¸¹å‚ ~ 
    ., margins = TRUE, scales = "free")

with(zs.hs.hz1, tapply(é—¨è¯Šå¿ƒè¡€ç®¡æ¬¡æ•?, æ˜¯å¦ä½¿ç”¨ä¸¹å‚, function(x) {
    sprintf("M (SD) = %1.2f (%1.2f)", mean(x), sd(x))
}))

#æ‹Ÿåˆè´ŸäºŒé¡¹å›å½?
summary(m1 <- MASS::glm.nb(é—¨è¯Šå¿ƒè¡€ç®¡æ¬¡æ•? ~., data = zs.hs.hz1))

zs.hs.hz1$predicty=fitted(m1)

with(zs.hs.hz1, tapply(predicty, æ˜¯å¦ä½¿ç”¨ä¸¹å‚, function(x) {
    sprintf("M (SE) = %1.2f (%1.2f)", mean(x), sd(x)/sqrt(length(x)))
}))

```

 bbb
###4ã€æ€»å¿ƒè¡€ç®¡äº‹ä»¶ç›¸å…³ä½é™¢æ¬¡æ•?


```{r}
#4ã€æ€»å¿ƒè¡€ç®¡äº‹ä»¶ç›¸å…³ä½é™¢æ¬¡æ•?
zs.hs.hz1=zs.hs.hz[,c("ä½é™¢å¿ƒè¡€ç®¡æ¬¡æ•?","æ€§åˆ«","ä¿é™©ç±»åˆ«","age","æ˜¯å¦ä½¿ç”¨ä¸¹å‚")]

#åŸºæœ¬æƒ…å†µæè¿°
ggplot(zs.hs.hz1, aes(ä½é™¢å¿ƒè¡€ç®¡æ¬¡æ•?, fill = æ˜¯å¦ä½¿ç”¨ä¸¹å‚)) + geom_histogram(binwidth = 1) + facet_grid(æ˜¯å¦ä½¿ç”¨ä¸¹å‚ ~ 
    ., margins = TRUE, scales = "free")

with(zs.hs.hz1, tapply(ä½é™¢å¿ƒè¡€ç®¡æ¬¡æ•?, æ˜¯å¦ä½¿ç”¨ä¸¹å‚, function(x) {
    sprintf("M (SD) = %1.2f (%1.2f)", mean(x), sd(x))
}))

#æ‹Ÿåˆè´ŸäºŒé¡¹å›å½?
summary(m1 <- MASS::glm.nb(ä½é™¢å¿ƒè¡€ç®¡æ¬¡æ•? ~., data = zs.hs.hz1))
zs.hs.hz1$predicty=fitted(m1)

with(zs.hs.hz1, tapply(predicty, æ˜¯å¦ä½¿ç”¨ä¸¹å‚, function(x) {
    sprintf("M (SE) = %1.2f (%1.2f)", mean(x), sd(x)/sqrt(length(x)))
}))

```

































